{"version":3,"sources":["../src/extensions.ts"],"sourcesContent":["import type { Operation } from './operation/index.js';\nimport type { OASDocument } from './types.js';\n\n/**\n * Enables custom-written code samples to be set for your operations. Use this if you have specific\n * formatting that may not be followed by the auto-generated code samples. Custom code samples are\n * treated as static content.\n *\n * This extension only be placed at the operation level.\n *\n * @defaultValue []\n * @see {@link https://docs.readme.com/main/docs/openapi-extensions#custom-code-samples}\n * @example\n * {\n *  \"x-readme\": {\n *    \"code-samples\": [\n *      {\n *        \"language\": \"curl\",\n *        \"code\": \"curl -X POST https://api.example.com/v2/alert\",\n *        \"name\": \"Custom cURL snippet\",\n *        \"install\": \"brew install curl\"\n *      },\n *      {\n *        \"language\": \"php\",\n *        \"code\": \"<?php echo \\\"This is our custom PHP code snippet.\\\"; ?>\",\n *        \"name\": \"Custom PHP snippet\"\n *      }\n *    ]\n *  }\n * }\n */\nexport const CODE_SAMPLES = 'code-samples';\n\n/**\n * Disables the API Explorer's \"Try It\" button, preventing users from making API requests from\n * within your docs. Users will still be able to fill out any entry fields (path or query\n * parameters, etc.), and code snippets will be auto-generated based on the user's input, however\n * to interact with your API the user will need to copy the code snippet and execute it outside of\n * your docs.\n *\n * This **does not** disable your API Reference documentation.\n *\n * @defaultValue true\n * @see {@link https://docs.readme.com/main/docs/openapi-extensions#disable-the-api-explorer}\n * @example\n * {\n *  \"x-readme\": {\n *    \"explorer-enabled\": true\n *  }\n * }\n */\nexport const EXPLORER_ENABLED = 'explorer-enabled';\n\n/**\n * Adds static headers to add to each request. Use this when there are specific headers unique to\n * your API.\n *\n * @defaultValue []\n * @see {@link https://docs.readme.com/main/docs/openapi-extensions#static-headers}\n * @example\n * {\n *  \"x-readme\": {\n *    \"headers\": [\n *      {\n *        \"key\": \"X-Static-Header-One\",\n *        \"value\": \"owlbert\"\n *      },\n *      {\n *        \"key\": \"X-Static-Header-Two\",\n *        \"value\": \"owlivia\"\n *      }\n *    ]\n *  }\n * }\n */\nexport const HEADERS = 'headers';\n\n/**\n * Disables API requests from the API Explorer's \"Try It\" button from being sent into our [API\n * Metrics](https://readme.com/metrics) for you and your users. Additionally on any API endpoint\n * that this is disabled on your users will not see lists or graphs of previous requests they've\n * made against that API endpoint â€” either through the API Explorer's interactivity or through one\n * of our [Metrics SDKs](https://docs.readme.com/main/docs/api-metrics-setup) (if you have those\n * installed on your API).\n *\n * @defaultValue true\n * @see {@link https://docs.readme.com/main/docs/openapi-extensions#disable-api-metrics}\n * @example\n * {\n *  \"x-readme\": {\n *    \"metrics-defaults\": false\n *  }\n * }\n */\nexport const METRICS_ENABLED = 'metrics-enabled';\n\n/**\n * Controls the order of parameters on your API Reference pages.\n *\n * Your custom ordering **must** contain all of our available parameter types:\n *\n *  - `path`: Path parameters\n *  - `query`: Query parameters\n *  - `body`: Non-`application/x-www-form-urlencoded` request body payloads\n *  - `cookie`: Cookie parameters\n *  - `form`: `application/x-www-form-urlencoded` request body payloads\n *  - `header`: Header parameters\n *\n * @defaultValue ['path', 'query', 'body', 'cookie', 'form', 'header']\n * @see {@link https://docs.readme.com/main/docs/openapi-extensions#parameter-ordering}\n * @example\n * {\n *  \"x-readme\": {\n *    \"parameter-ordering\": ['path', 'query', 'header', 'cookie', 'body', 'form']\n *  }\n * }\n */\nexport const PARAMETER_ORDERING = 'parameter-ordering';\n\n/**\n * Toggles the CORS proxy used when making API requests from within your docs (via the \"Try It\"\n * button). If your API is already set up to return CORS headers, you can safely disable this\n * feature.\n *\n * Disabling the CORS proxy will make the request directly from the user's browser and will prevent\n * [Metrics](https://docs.readme.com/main/docs/getting-started-with-metrics) data from being logged\n * by us unless [Metrics have already set up on your backend](https://docs.readme.com/main/docs/api-metrics-setup).\n *\n * @defaultValue true\n * @see {@link https://docs.readme.com/main/docs/openapi-extensions#cors-proxy-enabled}\n * @example\n * {\n *  \"x-readme\": {\n *    \"proxy-enabled\": true\n *  }\n * }\n */\nexport const PROXY_ENABLED = 'proxy-enabled';\n\n/**\n * Toggles what languages are shown by default for code samples in the API Explorer. This only\n * affects what languages are initially shown to the user; if the user picks another language from\n * the three-dot menu, that language and the respective auto-generated code snippet will also appear\n * as an option in the API Explorer.\n *\n * @defaultValue ['shell', 'node', 'ruby', 'php', 'python', 'java', 'csharp']\n * @see {@link https://docs.readme.com/main/docs/openapi-extensions#code-sample-languages}\n * @example\n * {\n *  \"x-readme\": {\n *    \"samples-languages\": [\"shell\", \"node\", \"ruby\", \"javascript\", \"python\"]\n *  }\n * }\n */\nexport const SAMPLES_LANGUAGES = 'samples-languages';\n\n/**\n * Toggles if you will see code snippets for ReadMe's SDK code generator tool `api`.\n *\n * @defaultValue true\n * @see {@link https://api.readme.dev}\n * @example\n * {\n *  \"x-readme\": {\n *    \"simple-mode\": false\n *  }\n * }\n */\nexport const SIMPLE_MODE = 'simple-mode';\n\nexport interface Extensions {\n  [CODE_SAMPLES]: {\n    code: string;\n    install?: string;\n    language: string;\n    name?: string;\n  };\n  [EXPLORER_ENABLED]: boolean;\n  [HEADERS]: Record<string, string | number>[];\n  [METRICS_ENABLED]: boolean;\n  [PARAMETER_ORDERING]: ('path' | 'query' | 'body' | 'cookie' | 'form' | 'header')[];\n  [PROXY_ENABLED]: boolean;\n  [SAMPLES_LANGUAGES]: string[];\n  [SIMPLE_MODE]: boolean;\n}\n\nexport const extensionDefaults: Extensions = {\n  [CODE_SAMPLES]: undefined,\n  [EXPLORER_ENABLED]: true,\n  [HEADERS]: undefined,\n  [METRICS_ENABLED]: true,\n  [PARAMETER_ORDERING]: ['path', 'query', 'body', 'cookie', 'form', 'header'],\n  [PROXY_ENABLED]: true,\n  [SAMPLES_LANGUAGES]: ['shell', 'node', 'ruby', 'php', 'python', 'java', 'csharp'],\n  [SIMPLE_MODE]: true,\n};\n\n/**\n * Determing if an OpenAPI definition has an extension set in its root schema.\n *\n */\nexport function hasRootExtension(extension: string | keyof Extensions, api: OASDocument) {\n  return Boolean(api && extension in api);\n}\n\n/**\n * Retrieve a custom specification extension off of the API definition.\n *\n */\nexport function getExtension(extension: string | keyof Extensions, api: OASDocument, operation?: Operation) {\n  if (operation) {\n    if (operation.hasExtension('x-readme')) {\n      const data = operation.getExtension('x-readme') as Extensions;\n      if (data && typeof data === 'object' && extension in data) {\n        return data[extension as keyof Extensions];\n      }\n    }\n\n    if (operation.hasExtension(`x-${extension}`)) {\n      return operation.getExtension(`x-${extension}`);\n    } else if (operation.hasExtension(extension)) {\n      return operation.getExtension(extension);\n    }\n  }\n\n  // Because our `code-samples` extension is intended for operation-level use, if it's instead\n  // placed at the API definition root level then we should ignore it and return our set defaults.\n  if (extension === CODE_SAMPLES) {\n    return extensionDefaults[extension];\n  }\n\n  if (hasRootExtension('x-readme', api)) {\n    const data = api?.['x-readme'] as Extensions;\n    if (data && typeof data === 'object' && extension in data) {\n      return data[extension as keyof Extensions];\n    }\n  }\n\n  if (hasRootExtension(`x-${extension}`, api)) {\n    return api?.[`x-${extension}`];\n  } else if (hasRootExtension(extension, api)) {\n    return api?.[extension];\n  }\n\n  // If this is otherwise an extension of our own then we should return the default value for it.\n  if (extension in extensionDefaults) {\n    return extensionDefaults[extension as keyof Extensions];\n  }\n\n  return undefined;\n}\n\n/**\n * Validate that the data for an instanceof our `PARAMETER_ORDERING` extension is properly\n * configured.\n *\n * @private\n */\nexport function validateParameterOrdering(\n  ordering: (typeof extensionDefaults)[typeof PARAMETER_ORDERING] | undefined,\n  extension: string,\n) {\n  const defaultValue = extensionDefaults[PARAMETER_ORDERING];\n  const requiredLength = defaultValue.length;\n  const defaultsHuman = `${defaultValue.slice(0, -1).join(', ')}, and ${defaultValue.slice(-1)}`;\n\n  if (ordering.length !== requiredLength) {\n    throw new TypeError(`\"${extension}\" must contain ${requiredLength} items comprised of: ${defaultsHuman}`);\n  }\n\n  const intersection = ordering.filter(value => defaultValue.includes(value.toLowerCase() as any));\n  if (intersection.length !== requiredLength) {\n    throw new TypeError(`\"${extension}\" must contain ${requiredLength} items comprised of: ${defaultsHuman}`);\n  }\n}\n"],"mappings":";AA+BO,IAAM,eAAe;AAoBrB,IAAM,mBAAmB;AAwBzB,IAAM,UAAU;AAmBhB,IAAM,kBAAkB;AAuBxB,IAAM,qBAAqB;AAoB3B,IAAM,gBAAgB;AAiBtB,IAAM,oBAAoB;AAc1B,IAAM,cAAc;AAkBpB,IAAM,oBAAgC;AAAA,EAC3C,CAAC,YAAY,GAAG;AAAA,EAChB,CAAC,gBAAgB,GAAG;AAAA,EACpB,CAAC,OAAO,GAAG;AAAA,EACX,CAAC,eAAe,GAAG;AAAA,EACnB,CAAC,kBAAkB,GAAG,CAAC,QAAQ,SAAS,QAAQ,UAAU,QAAQ,QAAQ;AAAA,EAC1E,CAAC,aAAa,GAAG;AAAA,EACjB,CAAC,iBAAiB,GAAG,CAAC,SAAS,QAAQ,QAAQ,OAAO,UAAU,QAAQ,QAAQ;AAAA,EAChF,CAAC,WAAW,GAAG;AACjB;AAMO,SAAS,iBAAiB,WAAsC,KAAkB;AACvF,SAAO,QAAQ,OAAO,aAAa,GAAG;AACxC;AAMO,SAAS,aAAa,WAAsC,KAAkB,WAAuB;AAC1G,MAAI,WAAW;AACb,QAAI,UAAU,aAAa,UAAU,GAAG;AACtC,YAAM,OAAO,UAAU,aAAa,UAAU;AAC9C,UAAI,QAAQ,OAAO,SAAS,YAAY,aAAa,MAAM;AACzD,eAAO,KAAK,SAA6B;AAAA,MAC3C;AAAA,IACF;AAEA,QAAI,UAAU,aAAa,KAAK,SAAS,EAAE,GAAG;AAC5C,aAAO,UAAU,aAAa,KAAK,SAAS,EAAE;AAAA,IAChD,WAAW,UAAU,aAAa,SAAS,GAAG;AAC5C,aAAO,UAAU,aAAa,SAAS;AAAA,IACzC;AAAA,EACF;AAIA,MAAI,cAAc,cAAc;AAC9B,WAAO,kBAAkB,SAAS;AAAA,EACpC;AAEA,MAAI,iBAAiB,YAAY,GAAG,GAAG;AACrC,UAAM,OAAO,MAAM,UAAU;AAC7B,QAAI,QAAQ,OAAO,SAAS,YAAY,aAAa,MAAM;AACzD,aAAO,KAAK,SAA6B;AAAA,IAC3C;AAAA,EACF;AAEA,MAAI,iBAAiB,KAAK,SAAS,IAAI,GAAG,GAAG;AAC3C,WAAO,MAAM,KAAK,SAAS,EAAE;AAAA,EAC/B,WAAW,iBAAiB,WAAW,GAAG,GAAG;AAC3C,WAAO,MAAM,SAAS;AAAA,EACxB;AAGA,MAAI,aAAa,mBAAmB;AAClC,WAAO,kBAAkB,SAA6B;AAAA,EACxD;AAEA,SAAO;AACT;AAQO,SAAS,0BACd,UACA,WACA;AACA,QAAM,eAAe,kBAAkB,kBAAkB;AACzD,QAAM,iBAAiB,aAAa;AACpC,QAAM,gBAAgB,GAAG,aAAa,MAAM,GAAG,EAAE,EAAE,KAAK,IAAI,CAAC,SAAS,aAAa,MAAM,EAAE,CAAC;AAE5F,MAAI,SAAS,WAAW,gBAAgB;AACtC,UAAM,IAAI,UAAU,IAAI,SAAS,kBAAkB,cAAc,wBAAwB,aAAa,EAAE;AAAA,EAC1G;AAEA,QAAM,eAAe,SAAS,OAAO,WAAS,aAAa,SAAS,MAAM,YAAY,CAAQ,CAAC;AAC/F,MAAI,aAAa,WAAW,gBAAgB;AAC1C,UAAM,IAAI,UAAU,IAAI,SAAS,kBAAkB,cAAc,wBAAwB,aAAa,EAAE;AAAA,EAC1G;AACF;","names":[]}